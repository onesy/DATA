/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */


(function(a){tuanpub.loginQueue=new a.Buffers("queue");tuanpub.logoutQueue=new a.Buffers("queue");tuanpub.queue=a.extend(tuanpub.queue,{login:function(){tuanpub.opts.login=true;a.each(tuanpub.loginQueue.toArray(),function(c,b){if(a.type(b)=="function"){try{b()}catch(d){}}})},logout:function(){tuanpub.opts.login=false;a.each(tuanpub.logoutQueue.toArray(),function(c,b){if(a.type(b)=="function"){try{b()}catch(d){}}})}})})(jQuery);(function(a){tuanpub.addModule("toolbar_pi",{Init:function(b){if(!tuanpub.loginQueue){tuanpub.loginQueue=new a.Buffers()}if(!tuanpub.logoutQueue){tuanpub.logoutQueue=new a.Buffers()}tuanpub.opts.login=a.cookie("ppinf")!=""?true:false},OnLoad:function(c){var b=this,d=a("#prologin").length==0?"tblogin":"prologin";PassportSC.drawPassportNew(d,this.toolbarTpl,{appid:3003,_this:b})},toolbarTpl:function(c,f,g){var b=PassportCardList[c];var d=document.location.href.indexOf("login")==-1?"?return_to="+encodeURIComponent(document.location.href):"?return_to="+encodeURIComponent("http://www.zhe800.com");b.rootElement=function(){this.cElement=f;this.sElement=f.after('<div class="hidden"></div>').next()};b.drawLoginForm=function(){var e=new a.Buffers();e.push('<a href="http://www.zhe800.com/login'+d+'">登录</a> <a href="http://www.zhe800.com/signup'+d+'">免费注册</a> <span></span>');e.push('<div class="mco"><a class="mcoa" href="javascript:">我的收藏</a></div>');this.cElement.html(e.toString())};b.drawPassportWait=function(e){this.cElement.html("登录中，请稍候...")};b._drawPassportCard=function(){var h=this.cookie,e=["未知","邮箱","手机","新浪微博","QQ","淘宝","人人网"],i='<a href="http://www.zhe800.com/profile/score_histories/all" class="user" target="_blank">'+h.userid+"</a>&nbsp;";if(h.nkd==0){i=e[h.regw]+'用户，请<a href="http://passport.tuan800.com/account/setting'+d+'" target="_blank" class="user">设置昵称</a>&nbsp;'}var k=new a.Buffers();k.push("您好，"+i);k.push('<div class="mco"><a class="mcoa" href="javascript:">我的收藏</a><div><ul class="favul"><li class="loading"></li><li class="more"><a target="_blank" href="http://www.zhe800.com/profile/my_favorites/all">查看全部收藏>></a></li></ul></div></div>');k.push('<a href="javascript:PassportCardList['+c+'].doLogout();">退出</a>');this.cElement.html(k.toString());if(h.nkd==0){f.find(".user").attr("href","http://passport.tuan800.com/account/setting"+d)}};if(f.attr("id")=="prologin"){b.logoutRedirectUrl="http://www.zhe800.com/"}b.loginApp=function(e){tuanpub.queue.login()};b.logoutApp=function(){b.loginApp();tuanpub.queue.logout()};b.drawPassport(f)}})})(jQuery);(function(a){tuanpub.addModule("login_passport",{Init:function(){if(!tuanpub.loginQueue){tuanpub.loginQueue=new a.Buffers()}},loginTpl:function(c,g,h){var f=this;var b=PassportCardList[c];var d=document.location.href.indexOf("login")==-1?"?return_to="+encodeURIComponent(document.location.href):"?return_to="+encodeURIComponent("http://www.zhe800.com");b.rootElement=function(){this.rootElement=g;this.rootElement.html('<div class="ppselecter" style="position: absolute; display: none;"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td style="" class="ppseltit" id="ppseltitId">'+this.selectorTitle+'</td></tr><tr><td /></tr></tbody></table></div><div style="display: none;"></div>');if(this.selectorTitle==null||this.selectorTitle.length==0){this.rootElement.html('<div class="ppselecter" style="position: absolute; display: none;"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr></tr><tr><td height="0"/></tr><tr><td /></tr></tbody></table></div>')}var e=this.rootElement.find("div");this.dsElement=e.eq(0);this.dsAnchor=this.dsElement.find("td:last");this.sElement=e.eq(1);g.parent().append('<div class="login_mid"></div>');this.cElement=g.next()};b._drawLoginForm=function(){var i="邮箱/手机号/用户名";var l=new a.Buffers();var k=document.location.href.indexOf("login")==-1?"?return_to="+encodeURIComponent(document.location.href):"?return_to="+encodeURIComponent("http://www.zhe800.com");if(b.emailPostfix!=null&&b.emailPostfix.length>0){var n=b.emailPostfix[0];if(typeof(j)=="string"&&j.indexOf("@")>-1){i=n}}l.push('<div class="top hidden">用户登录</div><span>已有折800、团800、惠800账号，可直接登录</span>');l.push('<form method="post" onsubmit="return PassportCardList['+c+'].doLogin();" name="loginform">');l.push('<label><strong>用户名：</strong><input value="'+i+'" id="ddusername" name="username" type="text" autocomplete="off" disableautocomplete="" class="t"/></label>');l.push('<label><strong>密&#12288;码：</strong><input value="" name="password" id="ddpw" type="password" class="required t" autocomplete="off" disableautocomplete="" style="display:none" /><input value="请输入密码" name="password1" id="ddpw1" type="text" class="required t" autocomplete="off" disableautocomplete="" /></label></label>');l.push('<label style="display:none;"> <strong>&nbsp;</strong><input type="checkbox" value="yes" checked="checked" name="frontend_remember_me"><span>下次自动登录</span></label>');l.push('<strong>&nbsp;</strong><input type="submit" value="" name="commit" class="b" id="login_submit"><a href="http://www.zhe800.com/password_retrieve">忘记密码</a>');l.push('<label><strong>&nbsp;</strong><span class="error" id="pperrmsg"></span></label>');l.push("</form>");l.push('	<div class="othlogin">');l.push("<h2>您还可以通过以下方式登录</h2>");l.push("<p>");l.push('<a class="sina" href="http://passport.tuan800.com/sso/partner_login/weibo'+k+'">新浪账号登录</a>');l.push('<a class="qq" href="http://passport.tuan800.com/sso/partner_login/qq_connect'+k+'">QQ号码登录</a>');l.push('<a class="taobao" href="http://passport.tuan800.com/sso/partner_login/taobao'+k+'">淘宝账号登录</a>');l.push('<a class="renren" href="http://passport.tuan800.com/sso/partner_login/renren'+k+'">人人账号登录</a>');l.push("</p>");l.push("	</div>");this.cElement.html(l.toString());var m=a("#ddpw"),e=a("#ddpw1");m.keyup(function(o){if(o.keyCode==13){PassportCardList[" + index + "].doLogin()}});m.blur(function(){if(a(this).val()==""){m.hide();e.show()}});e.focus(function(){e.hide();m.show().focus()});a("#ddusername").unbind("blur").blur(function(){if(a(this).val()==""){a("#ddusername").val(i)}});a("#ddusername").click(function(){if(a(this).val()==i){a(this).val("").focus()}}).focus(function(){if(a(this).val()==i){a(this).val("")}})};b.drawPassportWait=function(e){var i=new a.Buffers();i.push('<div class="pptitle">团800<b>通行证</b><div class="ppthree">');i.push(this.cardTitle);i.push('</div></div><div class="ppcontent clear" id="ppcontid"><div class="ppWaitMsg">');i.push(e);i.push("</div></div>");this.cElement.html(i.toString())};b._drawPassportCard=function(){var k=new a.Buffers();k.push('<div class="pptitle2"><span>团800<b>通行证</b><div class="ppthree">'+this.cardTitle+"</div></span>");k.push('<a class="exit" href="javascript:PassportCardList['+c+'].doLogout();">退出</a>');k.push("</div>");k.push('<div class="ppcontent clear" id="ppcontid"><div class="listContA"></div><div class="middle">');k.push("<ul>");if(this.defaultApp!=""){k.push('<li class="current">'+this.defaultApp+"</li>")}for(var l=0;l<this.bottomRow[0]["length"];l++){k.push('<li><a href="'+this.bottomRow[0][l]["url"]+'" target="_blank">'+this.bottomRow[0][l]["name"]+"</a></li>");if(l!=(this.bottomRow[0].length-1)){k.push("<li>|</li>")}}for(var l=0;l<this.bottomRow[1]["length"];l++){k.push('<li><a href="'+this.bottomRow[1][l]["url"]+'" target="_blank">'+this.bottomRow[1][l]["name"]+"</a></li>");if(l!=(this.bottomRow[1].length-1)){k.push("<li>|</li>")}}k.push('<li class="profile"');var n=PassportSC.campUrl;var m=a.getStringLen(this.cookie.username);var e=this.cookie.userid.indexOf("@");var i=this.cookie.userid.substr(e+1);if(this.domainList.toString().indexOf(i)<0||m>this.cookie.userid.length){}k.push('> | <a href="http://www.zhe800.com/profile/signal/all" target="_blank">个人中心</a></li></ul></div>');this.cElement.html(k.toString())};b.drawPassportInfo=function(){var i=this.cookie,e=["未知","邮箱","手机","新浪微博","QQ","淘宝","人人网"],k=i.userid;if(i.nkd==0){k=e[i.regw]+'用户，请<a href="http://passport.tuan800.com/account/setting'+d+'" target="_blank" class="user">设置昵称</a>'}var l=new a.Buffers();l.push("<ul><li>您好，"+k+"</li>");l.push("<li><p>欢迎您，您已经成功登录团800通行证！ </p></li><li>现在即可畅游团800所有服务。</li></ul>");this.iElement.html(l.toString());a(".diapassport .warning").html('<em class="m2"></em>您已经成功登陆团800通行证！')};b.loginApp=function(){if(a.getParm().return_to){var e=a.getParm().return_to;a.cookie("crossdomain",PassportSC.getTime(),{path:"/",expires:1});window.location.href=decodeURIComponent(e);return false}else{tuanpub.Queue.login()}};b.logoutApp=function(){b.loginApp();a(".diapassport .warning").html('<em class="m2"></em>登录后才能完成该操作!');tuanpub.Queue.logout()};b.drawPassport(g)},OnLoad:function(c){var b=this;if(a("#ppLogin").length>0){PassportSC.drawPassportNew("ppLogin",b.loginTpl,{appid:2001})}}})})(jQuery);